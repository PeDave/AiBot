@using BitgetApi.Dashboard.Web.Data.Models
@inject IJSRuntime JS

<div class="chart-container">
    <div class="chart-header">
        <h3>@Symbol - @Interval</h3>
        <div class="interval-selector">
            @foreach (var interval in Intervals)
            {
                <button class="interval-btn @(interval == Interval ? "active" : "")" 
                        @onclick="() => OnIntervalChanged(interval)">
                    @interval
                </button>
            }
        </div>
    </div>
    
    @* Chart rendering disabled for wallet dashboard *@
    @* <canvas id="priceChart" style="width: 100%; height: 500px;"></canvas> *@
    
    <div style="padding: 40px; text-align: center; color: #666;">
        <p>Chart view temporarily disabled</p>
        <p style="font-size: 12px; margin-top: 10px;">Focus on wallet and portfolio dashboard</p>
    </div>
</div>

@code {
    [Parameter] public string Symbol { get; set; } = "BTCUSDT";
    [Parameter] public string Interval { get; set; } = "1H";
    [Parameter] public List<CandleData> Candles { get; set; } = new();
    [Parameter] public EventCallback<string> OnIntervalChange { get; set; }

    private string[] Intervals = { "15m", "1H", "4H", "1D" };

    // Chart rendering disabled for wallet dashboard
    /*
    private bool chartInitialized = false;
    
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await Task.Delay(500); // Wait for Chart.js to load
            await InitializeChartAsync();
        }
    }

    protected override async Task OnParametersSetAsync()
    {
        if (chartInitialized && Candles.Any())
        {
            await UpdateChartAsync();
        }
    }
    */

    private async Task OnIntervalChanged(string interval)
    {
        await OnIntervalChange.InvokeAsync(interval);
    }

    // Chart rendering methods disabled for wallet dashboard
    /*
    private async Task InitializeChartAsync()
    {
        try
        {
            await JS.InvokeVoidAsync("initializeCandlestickChart", "priceChart");
            chartInitialized = true;
            
            if (Candles.Any())
            {
                await UpdateChartAsync();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Failed to initialize chart: {ex.Message}");
        }
    }

    private async Task UpdateChartAsync()
    {
        try
        {
            var chartData = Candles.Select(c => new
            {
                x = c.Timestamp,
                o = (double)c.Open,
                h = (double)c.High,
                l = (double)c.Low,
                c = (double)c.Close
            }).ToArray();

            Console.WriteLine($"Sending {chartData.Length} candles to chart");
            await JS.InvokeVoidAsync("updateCandlestickChart", chartData);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Failed to update chart: {ex.Message}");
        }
    }
    */
}
